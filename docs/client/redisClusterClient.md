### 新版Redis Cluster集群客户端设计与实现

    整体流程

                                                                                      ┌─────────────────┐
                                           ┌───────┐                                  │ ┌─────────────┐ │
                                           │       │      ┌────────┐    pipeline      │ │             │ │
                                           │       │      │        │                  │ │             │ │
                                           │       │─────▶│ client │─────────────────▶│ │   master1   │ │
                    ┌────────┐             │       │      │        │                  │ │             │ │
                    │        │             │       │      └────────┘                  │ │             │ │
                    │        │             │       │                                  │ ├─────────────┤ │
                    │        │             │       │      ┌────────┐    pipeline      │ │             │ │
                    │        │             │       │      │        │                  │ │             │ │
                    │ slave  │ ───────────▶│ crc16 │─────▶│ client │─────────────────▶│ │   master2   │ │
                    │        │             │       │      │        │                  │ │             │ │
                    │        │             │       │      └────────┘                  │ │             │ │
                    │        │             │       │                                  │ ├─────────────┤ │
                    │        │             │       │      ┌────────┐    pipeline      │ │             │ │
                    └────────┘             │       │      │        │                  │ │             │ │
                                           │       │─────▶│ client │─────────────────▶│ │   master3   │ │
                                           │       │      │        │                  │ │             │ │
                                           │       │      └────────┘                  │ │             │ │
                                           └───────┘                                  │ └─────────────┘ │
                                                                                      └─────────────────┘
                                                                                                         
                                                                                           cluster       
                                                                                                         
### 涉及到的问题
* ask、moved的处理
* 集成pipeline->提高同步速度
* 将crc16计算hash槽置前
* pipeline数据补偿与校验
* 断线重连
* 命令失败重试机制(涉及批量的key)
#### 将crc16计算hash槽置前问题
    为了更好的集成pipeline
#### ask、moved的处理
    处理pipeline中的 ask moved，pipeline中的response一定要按照顺序，并缓存这一批次的命令用于重试机制，要保证对于结果处理的强顺序性
    遇到ask moved相关reponse,需要将该类型命令封装到下一批次头部进行提交
### 断线重连
    该机制用于单个节点之间的因网络抖动导致的重连，可阶段性连续重试3次，若3次都未与目标节点建立正确的连接可视作整个客户端连接失败，并且宕掉任务
### 命令失败重试机制(涉及批量的key)
    一个批次内幂等的命令若在pipeline的结果集中显示失败，需要重新提交该批次内的所有与该key相关的幂等命令
        若非幂等命令提交失败，考虑宕掉任务


### 关于ask moved
    moved和ask重定向错误的区别在于，moved重定向错误是在迁移完成之后，ask重定向错误是在迁移过程中发生的。
    