redis4.0单例（同版本迁移）
### 1. 环境描述 
    name | 原生Redis |  原生Redis
    -|-|-
    服务器配置 |京东云服务器2核8G | 京东云服务器2核8G  |
    redis 版本 |  4.0.11          |   4.0.11 |
    外网ip | 114.67.100.239          |  114.67.100.238 |
    内网ip | 10.0.1.45          |  10.0.1.44 |
    redis连接密码 |  redistest0102          |  redistest0102 |
    测试服务器连接账号 |  root          |  root |
    测试服务器连接密码 |  Git785230          |  Git785230 |
    

### 2. Redis配置 
    name | 原生Redis |  原生Redis
    -|-|-
    maxmemory | 0（无限制） |  0（无限制） |
    maxmemory-policy | volatile-lru | volatile-lru |
    
### 3. 迁移同步程序服务器
    name | 原生Redis | 
    -|-|
    外网ip | 114.67.81.232 |
    账号 | root |
    密码 | Git785230 |
    
### 4. 测试同版本数据迁移
    在本地用redis-cli客户端分别连接源redis和目标redis，指令如下
        源redis
        redis-cli.exe -h 114.67.100.239 -p 6379 -a redistest0102
        目标redis
        redis-cli.exe -h 114.67.100.238 -p 6379 -a redistest0102
        
        先分别对两个redis数据库执行flushall清空命令
        
        源redis：
        
        114.67.100.239:6379> flushall
        OK
        (0.54s)
    
        目标redis:
        
        114.67.100.238:6379> flushall
        OK
       
       以db0库为例，分别执行info命令查看key数量都为0
       
       info
       结果：
           # Cluster
            cluster_enabled:0
        
            # Keyspace
            114.67.100.239:6379>
            
#### 4.1 先用redis-benchmark为源redis插入一部分数据
        
    本地执行redis-benchmark命令如下
    redis-benchmark -h 114.67.100.239 -p 6379 -a redistest0102  -c 100 -r 1000000 -n 120000 -t set -q -P 16
    
    
    -c 模拟100个客户端
    -r 选择测试键的范围大小为1000000
    pipelining -P 16 一次执行16条命令
    -n   请求数量 120000 次
    -t set 测试的命令
    
    执行结果如下：
    D:\software\redis\redis64-3.0.501>redis-benchmark -h 114.67.100.239 -p 6379 -a redistest0102  -c 100 -r 1000000 -n  100000 -t set,lpush,sadd -q -P 16
        SET: 23287.41 requests per second
    
    再用info命令查询源redis key数量 结果如下
    
        # Cluster
        cluster_enabled:0
        
        # Keyspace
        db0:keys=113557,expires=0,avg_ttl=0
        114.67.100.239:6379>
    
#### 4.2 开启数据迁移同步任务同时再开启redis-benchmark 往源redis插入数据

    开启同步任务请求如下 Post
    
    postman分享链接：
    
        https://www.getpostman.com/collections/7bd51ef5576671743b0c
    
    postman请求地址：http://114.67.81.232:8080/sync/startSync
    
    请求头： 
        Content-Type:application/json
    请求体：
        {
            "sourceUri": "redis://10.0.1.45:6379?authPassword=redistest0102",
            "targetUri": "redis://10.0.1.44:6379?authPassword=redistest0102",
            "threadName": "redis4",
            "idleTimeRunsMillis": 3000,
            "maxPoolSize": 200,
            "maxWaitTime": 100000,
            "minPoolSize": 1
        }
        
    返回200代表成功：
    
    {
        "msg": "success",
        "code": "200"
    }
    
    
    同时再次开启redis-benchmark往源redis插入数据，同步任务会自动将增量命令同步至目标redis
    
        D:\software\redis\redis64-3.0.501>    redis-benchmark -h 114.67.100.239 -p 6379 -a redistest0102  -c 100 -r 1000000 -n 120000 -t set -q -P 16
        SET: 17429.19 requests per second



#### 4.3 等待同步完成后分别info查询两个redis的key数量

    源redis：
        

    # Cluster
    cluster_enabled:0
    
    # Keyspace
    db0:keys=214077,expires=0,avg_ttl=0
    114.67.100.239:6379>
            
    目标redis：
    
    # Cluster
    cluster_enabled:0
    
    # Keyspace
    db0:keys=214077,expires=0,avg_ttl=0
    114.67.100.238:6379>